---
import { getCollection } from 'astro:content';
import BlogLayout from '../../layouts/BlogLayout.astro';
import { Image } from 'astro:assets';
import Comments from '../../components/Comments.vue';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  return blogEntries.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const translations = {
  en: { backToBlog: 'Back to Blog' },
  es: { backToBlog: 'Regresar al Blog' }
};

const t = translations[entry.data.lang] || translations.en;

// Preparar datos para Schema.org
const siteUrl = Astro.site || 'https://omarmtya.com';
const articleURL = new URL(`/blog/${entry.slug}`, siteUrl).href;
const imageURL = entry.data.image 
  ? (typeof entry.data.image === 'string' 
      ? new URL(entry.data.image, siteUrl).href 
      : entry.data.image.src)
  : undefined;

const schemaData = {
  title: entry.data.title,
  description: entry.data.description,
  url: articleURL,
  image: imageURL,
  author: entry.data.author,
  pubDate: entry.data.pubDate,
  modDate: entry.data.modDate,
  tags: entry.data.tags,
  lang: entry.data.lang
};
---

<BlogLayout 
  title={`${entry.data.title} | Omar Montoya`} 
  description={entry.data.description}
  image={imageURL}
  imageAlt={entry.data.title}
  lang={entry.data.lang}
  type="article"
  author={entry.data.author}
  pubDate={entry.data.pubDate}
  modDate={entry.data.modDate}
  tags={entry.data.tags}
  canonical={articleURL}
  hideLanguageSwitcher={true}
  schemaData={schemaData}
>
  <article class="py-4 md:py-8 min-h-screen relative">
    <div class="max-w-3xl mx-auto px-4">
      <a href="/blog" class="inline-flex items-center gap-2 text-slate-500 mb-8 hover:text-cyan-700 transition-colors font-sans text-sm font-medium">
        &larr; {t.backToBlog}
      </a>

      <header class="mb-12 border-b border-slate-200 pb-8">
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-slate-900 mb-8 leading-tight tracking-tight font-display">
          {entry.data.title}
        </h1>

        <div class="flex items-center gap-4 mb-8">
          <img 
            src="https://github.com/omarmtya.png" 
            alt={entry.data.author} 
            class="w-12 h-12 rounded-full border border-slate-100"
          />
          <div class="flex flex-col">
            <div class="flex items-center gap-2">
              <span class="capitalize text-slate-900 font-sans font-medium">{entry.data.author}</span>
              <span class="text-slate-300 text-xs">â€¢</span>
              <a href="https://x.com/omarxcode" target="_blank" rel="noopener noreferrer" class="text-cyan-700 text-sm hover:underline">Follow</a>
            </div>
            <div class="flex items-center gap-2 text-sm text-slate-500 font-sans">
              <time datetime={entry.data.pubDate.toISOString()}>
                {entry.data.pubDate.toLocaleDateString(entry.data.lang === 'es' ? 'es-ES' : 'en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
              </time>
            </div>
          </div>
        </div>

        <div class="flex gap-2 mb-8">
          {entry.data.tags.map(tag => (
            <span class="px-3 py-1 text-xs font-sans font-medium text-cyan-700 bg-cyan-50 rounded-full border border-cyan-100">
              #{tag}
            </span>
          ))}
        </div>

        {entry.data.image && (
          <div class="rounded-lg overflow-hidden shadow-md">
            <Image 
              src={entry.data.image} 
              alt={entry.data.title}
              width={1200}
              height={600}
              class="w-full h-auto object-cover"
            />
          </div>
        )}
      </header>

      <div class="prose-blog">
        <Content />
      </div>

      <div class="mt-4 pt-8 border-t border-slate-200">
         <Comments client:load lang={entry.data.lang} />
      </div>
    </div>
  </article>
</BlogLayout>
